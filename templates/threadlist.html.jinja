{%extends 'base.html.jinja'%}
{%block content%}

{{macros.paginate(pagination)}}

<div class="threadlist">
  {%for t in threadlist%}
    {{macros.post_threadlist(t)}}
  {%endfor%}
</div>

{{macros.paginate(pagination)}}


{%endblock%}

{%block navigator%}
<div id="navigator" class="">

  {%if categories%}

  <div class="box">
    <div class="boxtitle">
      分类列表
    </div>

    <div class="categories">
      {%for c in categories%}
      {{macros.category_bubble(c)}}
      {%endfor%}
    </div>
  </div>

  {%endif%}

  {%if common_links %}
  <div class="box">
    <div class="boxtitle">
      常用链接
    </div>
    <div class="categories">
      {%for l in common_links%}
      {{macros.link_bubble(l)}}
      {%endfor%}
    </div>

  </div>

  {%endif%}

  <div class="box">
    <div class="boxtitle">
      语录
    </div>
    <div class="navigator_quote">
      {%import 'base.html.jinja' as base with context%}

      {{base.quote_section(get_quote())}}
    </div>
  </div>


  {%macro list_threads(wb) %}
  <div class="weekly_best">
    {%for i in wb%}
    <div class="weekly_best_item">
      <div class='weekly_best_votes'>{{i.amv}}</div>
      <div class='weekly_best_title'>
        {%set url = ('/p/'~i.mvp) if i.mv> i.votes else ('/t/'~i.tid)%}
        <a href="{{url}}">{{i.title}}</a>
      </div>
    </div>
    {%endfor%}
  </div>
  {%endmacro%}

  {%set wb = get_weekly_best(7,14)%}
  <div class="box">
    <div class="boxtitle">
      上周最佳
    </div>
    {{list_threads(wb)}}
  </div>

  {%set wb = get_weekly_best(14, 14+30, n=15)%}
  <div class="box">
    <div class="boxtitle">
      上月最佳
    </div>
    {{list_threads(wb)}}
  </div>

  {%set wb = get_weekly_best_user(7, 14, n=20)%}
  <div class="box">
    <div class="boxtitle">
      上周获赞
    </div>
    <div class="weekly_best">
      {%for i in wb%}
      <div class="weekly_best_item">
        <div class='weekly_best_votes'>{{i.n}}</div>
        <div class='weekly_best_title'>
          {{macros.username(i.user)}}
        </div>
      </div>
      {%endfor%}
    </div>
  </div>


</div>

{%endblock%}
