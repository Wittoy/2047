{%extends 'base.html.jinja'%}
{%block content%}

<div class="threadlist">
  {{macros.post_userpage(u)}}
</div>

<div class="threadlist">
  {%if g.logged_in and updateable_personal_info%}
    <div class="invitations">
      <div class="invitation_list_title">
        修改个人资料
      </div>

      <div class="register" id="update_personal_info">
        {%for item, explain in updateable_personal_info%}
          <label>{{explain}}</label>
          <input type="text" id="{{item}}" value={{g.logged_in[item]}}>
          <br>
        {%endfor%}

        <button type="button" id="button_update_personal_info">修改个人资料</button>
      </div>
    </div>
  {%endif%}

  {%if (invitations!=None)%}
  <div class="invitations">
    <div class="invitation_list_title">
      我的邀请码
    </div>
    <div class="invitation_list">

      {%for i in invitations%}
      <div class="invitation{{'' if i.active else ' inactive'}}">
        <a href="/register?code={{i._key}}">{{i._key}}</a>
        <span>{{format_time_datetime(i.t_c) if i.t_c}}</span>
        <span>{{'未使用' if i.active else '已使用'}}</span>
        {%if i.users%}
          <a href="/u/{{i.users[0].uid}}">{{i.users[0].name}}</a>
        {%endif%}
      </div>
      {%endfor%}

    </div>
    <button type="button" onclick='generate_invitation_code()'>生成邀请码</button>
  </div>
  {%endif%}

  {%if g.logged_in and g.logged_in.uid==u.uid%}
  <form class="register">
    <label>用户名</label>
    <input type="text" id="username" value="{{g.logged_in.name}}" disabled="true">
    <br>
    <label>原密码</label>
    <input type="password" id="old_password" value="" placeholder="（若没有则留空）">
    <br>
    <label>新密码</label>
    <input type="password" id="new_password" value="">
    <br>
    <label>再输入一次</label>
    <input type="password" id="password2" value="">
    <br>
    <button type="button" id="change_password">修改密码</button>
  </form>

  <div class="post_content warning">
    {{password_warning|safe}}
  </div>

  {%endif%}
</div>

{%endblock%}
